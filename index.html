<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Fishbone Diagram Tool</title>

  <!-- Export helpers -->
  <script src="https://cdn.jsdelivr.net/npm/html2canvas@1.4.1/dist/html2canvas.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/html2pdf.js/0.10.1/html2pdf.bundle.min.js"></script>

  <style>
    :root{
      --nhs-blue:#005eb8;
      --bone:#c00000;         /* close to the red used in your example */
      --bone-dark:#8a0000;
      --bg:#f5f5f5;
      --card:#ffffff;
      --text:#111;
      --muted:#666;
    }

    body{
      margin:0;
      padding:18px;
      font-family: system-ui, -apple-system, "Segoe UI", Roboto, Arial, sans-serif;
      background:var(--bg);
      color:var(--text);
    }

    header{
      background: var(--nhs-blue);
      color:#fff;
      border-radius:10px;
      padding:12px 14px;
      display:flex;
      gap:12px;
      align-items:flex-start;
      justify-content:space-between;
      flex-wrap:wrap;
      margin-bottom:14px;
    }
    header h1{
      margin:0;
      font-size:1.25rem;
      line-height:1.2;
    }
    header p{
      margin:6px 0 0 0;
      color:#e7f0ff;
      font-size:0.88rem;
      max-width:820px;
    }

    .toolbar{
      display:flex;
      flex-wrap:wrap;
      gap:8px;
      align-items:center;
      justify-content:flex-end;
    }
    .toolbar button, .toolbar label{
      border:1px solid rgba(255,255,255,0.75);
      background: rgba(255,255,255,0.12);
      color:#fff;
      border-radius:999px;
      padding:6px 10px;
      font-size:0.82rem;
      cursor:pointer;
      user-select:none;
      white-space:nowrap;
    }
    .toolbar button:hover, .toolbar label:hover{ background: rgba(255,255,255,0.2); }
    .toolbar input[type="file"]{ display:none; }

    .card{
      background:var(--card);
      border-radius:10px;
      box-shadow: 0 2px 6px rgba(0,0,0,0.08);
      padding:12px;
    }

    /* Diagram wrapper */
    #diagramWrapper{
      position:relative;
      border:1px solid #e2e2e2;
      border-radius:10px;
      overflow:hidden;
      background:#fff;
      min-height:720px;
    }

    /* Overlay “grid” for the text regions */
    #regionsLayer{
      position:absolute;
      inset:0;
      display:grid;
      grid-template-rows: 1fr 110px 1fr;
      padding:18px 18px 18px 18px;
      box-sizing:border-box;
      pointer-events:none; /* we will enable pointer events per region */
    }

    .rowTop, .rowBottom{
      display:grid;
      gap:0;
      pointer-events:none;
    }

    .spineRow{
      position:relative;
      pointer-events:none;
    }

    /* Each region is a column cell that holds content */
    .region{
      position:relative;
      padding:10px 14px;
      box-sizing:border-box;
      pointer-events:auto;
    }

    /* Category label boxes (at top and bottom edges) */
    .catLabel{
      position:absolute;
      left:50%;
      transform:translateX(-50%);
      background:#fff;
      border:2px solid var(--bone);
      color:var(--bone);
      padding:6px 10px;
      font-weight:700;
      border-radius:0;
      font-size:0.92rem;
      line-height:1.15;
      min-width: 180px;
      max-width: 90%;
      text-align:center;
      box-sizing:border-box;
      cursor:text;
    }
    .catLabel.top{ top: 8px; }
    .catLabel.bottom{ bottom: 8px; }

    /* Content inside region */
    .content{
      margin-top:56px;
      margin-bottom:56px;
      font-size:12px;
      line-height:1.25;
      color:#111;
    }

    .block{
      margin: 8px 0 10px 0;
    }

    .blockTitle{
      font-weight:800;
      margin-bottom:3px;
      cursor:text;
    }

    .bullets{
      margin:0;
      padding-left:16px;
    }
    .bullets li{
      margin:2px 0;
      cursor:text;
    }

    /* Inline editing */
    [contenteditable="true"]:focus{
      outline: 2px solid rgba(0,94,184,0.35);
      outline-offset:2px;
      border-radius:4px;
    }

    /* Hover controls inside regions */
    .regionControls{
      position:absolute;
      top:52px;
      right:10px;
      display:flex;
      gap:6px;
      opacity:0;
      transition:opacity 120ms ease;
      pointer-events:auto;
    }
    .region:hover .regionControls{ opacity:1; }

    .chipBtn{
      font-size:11px;
      padding:4px 8px;
      border-radius:999px;
      border:1px solid #ddd;
      background:#fff;
      cursor:pointer;
      user-select:none;
    }
    .chipBtn:hover{ background:#f5f7fb; }

    .danger{ border-color: rgba(213,40,27,0.35); color:#b11c12; }

    /* Small delete control for blocks/bullets */
    .del{
      display:inline-block;
      margin-left:6px;
      font-size:11px;
      color:#b11c12;
      cursor:pointer;
      user-select:none;
      opacity:0.0;
      transition:opacity 120ms ease;
    }
    .block:hover .del, .bullets li:hover .del{ opacity:0.95; }

    /* Effect arrow text overlay */
    #effectText{
      position:absolute;
      right:22px;
      top:50%;
      transform:translateY(-50%);
      width:240px;
      color:#fff;
      font-weight:700;
      font-size:12px;
      line-height:1.25;
      text-align:left;
      pointer-events:auto;
      padding:12px 14px 12px 14px;
      box-sizing:border-box;
    }
    #effectText .hint{
      display:block;
      font-weight:600;
      opacity:0.9;
      margin-top:6px;
      font-size:11px;
    }

    /* On-canvas “add category” buttons */
    .addCategoryBtn{
      position:absolute;
      width:26px;
      height:26px;
      border-radius:999px;
      background:#fff;
      border:2px solid var(--bone);
      color:var(--bone);
      display:flex;
      align-items:center;
      justify-content:center;
      font-weight:900;
      cursor:pointer;
      user-select:none;
      box-shadow: 0 1px 2px rgba(0,0,0,0.08);
      pointer-events:auto;
    }
    .addCategoryBtn:hover{ background:#fff6f6; }
    #addTopBtn{ left:18px; top:18px; }
    #addBottomBtn{ left:18px; bottom:18px; }

    /* Export-clean mode (hide edit controls) */
    .export-clean .regionControls,
    .export-clean .del,
    .export-clean .addCategoryBtn{
      display:none !important;
    }

    /* Subtle footer note */
    .note{
      font-size:12px;
      color:var(--muted);
      margin-top:8px;
    }
  </style>
</head>

<body>
<header>
  <div>
    <h1>Fishbone Diagram Tool</h1>
    <p>
      Click any label, heading or bullet to edit directly on the diagram. Hover in a section to add headings/bullets.
      Use JSON import/export to save and continue later; export PNG/PDF for reports.
    </p>
  </div>

  <div class="toolbar">
    <button id="btnExportJSON" type="button">Export JSON</button>
    <label>Import JSON
      <input id="fileImportJSON" type="file" accept=".json" />
    </label>
    <button id="btnExportPNG" type="button">Export PNG</button>
    <button id="btnExportPDF" type="button">Export PDF</button>
    <button id="btnReset" type="button">Reset</button>
  </div>
</header>

<div class="card">
  <div id="diagramWrapper">
    <!-- Bones / arrow are SVG -->
    <svg id="bonesSvg" width="100%" height="720" viewBox="0 0 1200 720" preserveAspectRatio="none"
         style="display:block;">
      <!-- Drawn by JS -->
    </svg>

    <!-- In-canvas buttons to add categories -->
    <div id="addTopBtn" class="addCategoryBtn" title="Add a top category">+</div>
    <div id="addBottomBtn" class="addCategoryBtn" title="Add a bottom category">+</div>

    <!-- Text regions overlay -->
    <div id="regionsLayer">
      <div class="rowTop" id="rowTop"></div>
      <div class="spineRow"></div>
      <div class="rowBottom" id="rowBottom"></div>
    </div>

    <!-- Effect (inside arrow) -->
    <div id="effectText" contenteditable="true" spellcheck="false"></div>
  </div>

  <div class="note">
    Tip: Hover over a section to reveal “+ Heading / + Bullet / Remove category”. Click text to edit. Use the small ✕ to delete blocks/bullets.
  </div>
</div>

<script src="fishbone.js"></script>
</body>
</html>
